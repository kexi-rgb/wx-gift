<script>
  const content = `遇到什么事啦（｀Δ´）ゞ？  
被谁欺负了！我将悄悄诅咒他！  
不要不开心，恭喜你中大奖~  
专属于你一个人特别奖励  
在24小时内将兑现  
请查收！  
如果生活让你不如意，不如出去走走看看！`;

  const textElement = document.getElementById('text');
  const cursor = document.getElementById('cursor');
  const loader = document.getElementById('loader');
  const progressBar = document.getElementById('progress-bar');
  const mainContent = document.getElementById('main-content');
  const bgm = document.getElementById('bgm');
  let i = 0;

  // === 假进度条动画 ===
  let progress = 0;
  const fakeLoading = setInterval(() => {
    progress += Math.random() * 10;
    if (progress > 100) progress = 100;
    progressBar.style.width = progress + "%";
    if (progress >= 100) {
      clearInterval(fakeLoading);
      setTimeout(() => {
        loader.style.opacity = 0;
        loader.style.visibility = "hidden";
        mainContent.style.opacity = 1;
        showOpenButton();
      }, 600);
    }
  }, 200);

  // === 显示“拆开信封”按钮 ===
  function showOpenButton() {
    const btn = document.createElement("button");
    btn.textContent = "💌 拆开信封";
    btn.style.marginTop = "20px";
    btn.style.padding = "10px 20px";
    btn.style.border = "1px solid #666";
    btn.style.background = "rgba(255,255,255,0.1)";
    btn.style.color = "#eee";
    btn.style.borderRadius = "8px";
    btn.style.fontFamily = "'Noto Serif SC', serif";
    btn.style.cursor = "pointer";
    btn.style.transition = "all 0.3s ease";
    btn.onmouseenter = () => btn.style.background = "rgba(255,255,255,0.2)";
    btn.onmouseleave = () => btn.style.background = "rgba(255,255,255,0.1)";
    mainContent.appendChild(btn);

    btn.addEventListener("click", async () => {
      btn.disabled = true;
      btn.textContent = "正在拆开中...";
      try {
        const res = await fetch("https://notify.wxgift.top/");
        console.log("Notify sent:", await res.text());
      } catch (err) {
        console.warn("Notify API failed:", err);
      }
      btn.style.opacity = "0";
      setTimeout(() => btn.remove(), 500);
      startTyping();
      tryPlayBgm();
    });
  }

  // === 打字机效果 ===
  function startTyping() {
    if (i < content.length) {
      textElement.textContent += content[i];
      i++;
      setTimeout(startTyping, 70);
    } else {
      cursor.style.display = 'none';
    }
  }

  // === 尝试播放音乐 ===
  function tryPlayBgm() {
    if (bgm) {
      bgm.play().catch(() => {
        console.log("等待用户点击以播放音乐");
      });
    }
  }
</script>
